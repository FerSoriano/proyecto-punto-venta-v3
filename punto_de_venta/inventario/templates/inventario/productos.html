{% extends "base.html" %}

{% block title %}Productos{% endblock title %}

{% block content %}
    <div class="card">
        <div class="card-header">
            <h4>Productos en Inventario</h4>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Precio de Compra</th>
                            <th>Precio de Venta</th>
                            <th>Existencias</th>
                            <th>Nivel de Reorden</th>
                            <th>Estado</th>
                            <th>Resurtir</th>
                            <th>Fecha de Alta</th>
                            <th>Última Modificación</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for producto in productos %}
                            <tr {% if producto.status == 0 %}
                                    class="table-danger"
                                {% elif producto.resurtir %} 
                                    class="table-warning"
                                {% endif %}>
                                <td>{{ producto.nombre }}</td>
                                <td>${{ producto.precio_compra }}</td>
                                <td>${{ producto.precio_venta }}</td>
                                <td>{{ producto.existencias }}</td>
                                <td>{{ producto.nivel_reorden }}</td>
                                <td>
                                    {% if producto.status %}
                                        <span class="badge bg-success">Activo</span>
                                    {% else %}
                                        <span class="badge bg-danger">Inactivo</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if producto.resurtir %}
                                        Sí
                                    {% else %}
                                        No
                                    {% endif %}
                                </td>
                                <td>{{ producto.fecha_alta }}</td>
                                <td>{{ producto.fecha_modificacion }}</td>
                                <td>
                                    {% if producto.status %}
                                        <a href="{% url 'editar_producto' producto.id %}" class="btn btn-warning btn-sm">Editar</a>
                                        <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirmarEliminarModal" data-producto-id="{{ producto.id }}" data-producto-nombre="{{ producto.nombre }}">
                                            Eliminar
                                        </button>
                                    {% else %}
                                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#confirmarReactivarModal" data-producto-id="{{ producto.id }}" data-producto-nombre="{{ producto.nombre }}">
                                            Reactivar
                                        </button>
                                    {% endif %}
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="9" class="text-center">No hay productos disponibles.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="confirmarEliminarModal" tabindex="-1" aria-labelledby="confirmarEliminarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="confirmarEliminarModalLabel">Confirmar Eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que quieres eliminar el producto <strong id="productoNombre"></strong>? Esta acción no se puede deshacer.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form id="formEliminarProducto" method="post" action="">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmarReactivarModal" tabindex="-1" aria-labelledby="confirmarReactivarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="confirmarReactivarModalLabel">Confirmar Reactivación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que quieres reactivar el producto <strong id="productoNombreReactivar"></strong>?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form id="formReactivarProducto" method="post" action="">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">Reactivar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block extra_js %}
<script>
    // Eliminar
    const confirmarEliminarModal = document.getElementById('confirmarEliminarModal');
    confirmarEliminarModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const productoId = button.getAttribute('data-producto-id');
        const productoNombre = button.getAttribute('data-producto-nombre');

        const modalNombre = confirmarEliminarModal.querySelector('#productoNombre');
        modalNombre.textContent = productoNombre;

        const formEliminar = confirmarEliminarModal.querySelector('#formEliminarProducto');
        formEliminar.action = `${productoId}/eliminar/`;
    });

    // Reactivar
    const confirmarReactivarModal = document.getElementById('confirmarReactivarModal');
    confirmarReactivarModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const productoId = button.getAttribute('data-producto-id');
        const productoNombre = button.getAttribute('data-producto-nombre');

        const modalNombre = confirmarReactivarModal.querySelector('#productoNombreReactivar');
        modalNombre.textContent = productoNombre;

        const formReactivar = confirmarReactivarModal.querySelector('#formReactivarProducto');
        formReactivar.action = `${productoId}/reactivar/`;;
    });
</script>
{% endblock extra_js %}